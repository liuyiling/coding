<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>厦门航空</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="aplus-touch" content="1"/>
    <link rel="stylesheet" href="../../stylesheets/applyRefund.css"/>
    <script>(function(a){var d=document.documentElement,c=null;function b(){a.rem=d.getBoundingClientRect().width/20;if(/ZTE U930_TD/.test(navigator.userAgent)){a.rem=a.rem*1.13}d.style.fontSize=a.rem+"px"}b();a.addEventListener("resize",function(){clearTimeout(c);c=setTimeout(b,300)});a.addEventListener("orientationchange",function(){clearTimeout(c);c=setTimeout(b,300)})})(window,undefined);
    </script>
    <script src="../../common/zepto.min.js"></script>
</head>
<body>
<div class="nav-bar">
    <span class="back J_HistoryBack">返回</span>
    申请退票
</div>

<div class="refund-list">
    <div class="refund-fareInfo J_FareInfo">
        <span>票价信息</span>
        <span class="rectangle-down"></span>
    </div>
    <div class="J_FareInfoOpen" style="display: none">
        <div class="people-info-list">
            <div class="people-info-name J_PeoInfo">
                <span>杨晔 731-2289189</span>
                <span class="rectangle-blue-down"></span>
            </div>
            <div class="J_PeoInfoOpen" style="display: none">
                <div class="people-ticket-list">
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">儿童票（返程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">儿童票（返程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">1900*10%*1</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">机建(往返)</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">燃油(往返)</div>
                        <div class="flex-item text-right price-little">¥0</div>
                        <div class="flex-item text-right">0</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">机票意外险</div>
                        <div class="flex-item text-right price-little">¥30</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">机票延误险</div>
                        <div class="flex-item text-right price-little">¥20</div>
                        <div class="flex-item text-right">0</div>
                    </div>
                </div>
                <div class="people-ticket-list">
                    <div class="flex">
                        <div class="flex-item">已退保险金额</div>
                        <div class="flex-item text-right price-little">-¥100</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">手续费（去程）</div>
                        <div class="flex-item text-right price-little">-¥0</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">手续费（返程）</div>
                        <div class="flex-item text-right price-little">-¥0</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="people-info-list">
            <div class="people-info-name J_PeoInfo J_pen2">
                <span>陈晓 731-2289205</span>
                <span class="rectangle-blue-down"></span>
            </div>
            <div class="J_PeoInfoOpen" style="display: none">
                <div class="people-ticket-list">
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">儿童票（返程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">儿童票（返程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">1900*10%*1</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">机建(往返)</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">燃油(往返)</div>
                        <div class="flex-item text-right price-little">¥0</div>
                        <div class="flex-item text-right">0</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">机票意外险</div>
                        <div class="flex-item text-right price-little">¥30</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">机票延误险</div>
                        <div class="flex-item text-right price-little">¥20</div>
                        <div class="flex-item text-right">0</div>
                    </div>
                </div>
                <div class="people-ticket-list">
                    <div class="flex">
                        <div class="flex-item">已退保险金额</div>
                        <div class="flex-item text-right price-little">-¥100</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">手续费（去程）</div>
                        <div class="flex-item text-right price-little">-¥0</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">手续费（返程）</div>
                        <div class="flex-item text-right price-little">-¥0</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="price-list">
            <div class="flex price-item">
                <div class="flex-item">付款总额</div>
                <div class="flex-item text-right"><span class="price">￥<span class="fs24">10860</span></span></div>
            </div>
            <div class="flex price-item">
                <div class="flex-item">退款总额</div>
                <div class="flex-item text-right"><span class="price-green">￥<span class="fs24" id="J_TotalRefundPrice">9810</span></span></div>
            </div>
        </div>
    </div>
</div>

<div class="refund-reason">
    <div class="refund-cause flex" id="J_RefundCause">
        <div class="flex-item2">退款原因</div>
        <div class="flex-item3 reason-type">自愿退票（快速）</div>
        <div class="flex-item"><span class="arrow-right"></span></div>
    </div>
    <div class="refund-text" id="J_CauseContent" style="display: none">
        <div class="refund-con">
            <textarea class="textarea" placeholder="请输入退票原因" rows="10"></textarea>
        </div>
    </div>
</div>


<div class="refund-remark flex">
    <div class="flex-item4 remarks-column">注:手续费按同航班经济舱全价票的10%收取。</div>
    <div class="flex-item text-right refund-rule J_refundRule">退票规则</div>
</div>


<div class="text-center mt40 mb40">
    <a class="btn" href="javascript:;" id="J_RefundSure">确认退票</a>
</div>


<script type="text/juicer" id="J_ListTpl">

    {@each Date.orderPassengerInfoDto as item}

        <div class="people-info-list">
            <div class="people-info-name J_PeoInfo">
                <span>${item.psgrName} ${item.etCode}</span>
                <span class="rectangle-blue-down"></span>
            </div>
            <div class="J_PeoInfoOpen" style="display: none">
                <div class="people-ticket-list">
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">1900*10%*1</div>
                    </div>
                </div>
                <div class="people-ticket-list">
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">1900*10%*1</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="people-info-list">
            <div class="people-info-name J_PeoInfo">
                <span>陈晓 731-2289205</span>
                <span class="rectangle-blue-down"></span>
            </div>
            <div class="J_PeoInfoOpen" style="display: none">
                <div class="people-ticket-list">
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">1900*10%*1</div>
                    </div>
                </div>
                <div class="people-ticket-list">
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">x1人</div>
                    </div>
                    <div class="flex">
                        <div class="flex-item">成人票（去程）</div>
                        <div class="flex-item text-right price-little">¥1900</div>
                        <div class="flex-item text-right">1900*10%*1</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="price-list">
            <div class="flex price-item">
                <div class="flex-item">付款总额</div>
                <div class="flex-item text-right"><span class="price">￥<span class="fs24">10860</span></span></div>
            </div>
            <div class="flex price-item">
                <div class="flex-item">退款总额</div>
                <div class="flex-item text-right"><span class="price-green">￥<span class="fs24" id="J_TotalRefundPrice">9810</span></span></div>
            </div>
        </div>

     {@/each}

</script>

<script src="../../common/sea.js"></script>
<script src="../../common/sea-config.js"></script>

<script>
    seajs.use(['loading', 'toast', 'juicer', 'radioPad', 'pad', 'sm', 'util', 'common'], function(Loading, Toast, Juicer, RadioPad, Pad, SM, Util, Common) {

        var WIN = window;
        var DOC = document;

        // var loading = new Loading();
        // loading.show()
        // setTimeout(function(){
        //     loading.hide();
        // }, 2000)

        // Toast('aaaa');

        // 票价信息折叠
        $(DOC).delegate('.J_FareInfo', 'click', function(){
            var self = $(this);
            var content = $('.J_FareInfoOpen');

            self.toggleClass('active');
            content.toggle();

        });

        //乘机人信息折叠
        $(DOC).delegate('.J_PeoInfo', 'click', function(){
            var self = $(this),
                parent = self.parent('.people-info-list');
            var content = parent.find('.J_PeoInfoOpen');

            self.toggleClass('active');
            content.toggle();

        });

        //退票规则pad
        var pad = new Pad({
            height: '200px',
            fadeIn: true,
            content: '<div class="pad-panel"><div class="title">退票规则</div><div class="content"><div class="rule-mask-con"><h1>退票条件</h1><p>航班日起飞前2小时前（含）经济舱全票价(Y)的5%（特殊时段为10%），起飞前2小时后经济舱全票价(Y)的10%（特殊时段为20%）；此外，来回程客票，若部分使用，应选返还已享受的优惠，同时收取舱位对应的退票费。<br />（注：特殊时段是指航班日为每年春运、7月1日-8月31日期间）</p></div></div></div>',
            tapMaskCallback: function(){
                pad.hide();
            },
            afterHide: function(){
                console.log('pad hide');
            }
        });
        $(DOC).delegate('.J_refundRule', 'click', function(){
            pad.show();
        });

        //退票原因
        var radioGroup = new RadioPad({
            title: '退票原因',
            //customClass: 'aaa',
            initIndex: 0,
            radioList: [
                {
                    key: 'voluntaryRefund',
                    value: '自愿退票（快速）'
                },
                {
                    key: 'otherReasons',
                    value: '其他原因'
                }
            ],
            onChange: function (e) {
                console.log(e);
                radioGroup.hide();
                $('.reason-type').text(e.value);
                if (e.value == '其他原因'){
                    $('#J_CauseContent').show();
                }else{
                    $('#J_CauseContent').hide();
                    $('.textarea').val('');
                }

            }
        });
        $(DOC).delegate('#J_RefundCause', 'click', function(){
            radioGroup.show();
        });


        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for(var i = 0; i < strs.length; i ++) {
                    theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
 　　     var Request = new Object();
 　　          Request = GetRequest();
        var a= Request['a'];
        if(a == '1'){
            $('.J_pen2').hide();
        }



        //获取乘机人票价详细信息
        //var objClone = JSON.parse(Util.locStorage.get('airOrderInfo'));

        //var tpl = $('#J_ListTpl').html();

        //var htmlStr = Juicer(tpl,objClone);

        //$('.J_FareInfoOpen').append(htmlStr);



        //入参数据获取
        // 订单号 objClone.orderNo;
        // 用户ID objClone.userId;
        // 退票原因描述 $('.textarea').val('')
        // 金额  $('#J_TotalRefundPrice').html();


        //点击确认退款
        $(DOC).delegate('#J_RefundSure', 'click', function(){

            //todo ajax
            //
            // $.ajax({
            //      type: 'POST',
            //      url: 'http://11.4.66.30:8080/xmusp-ws/ws/payment/refund',
            //      data: {"payOrderNo":"123420170505152901438104","orderNo":"1234","description":"测试退款","userId":"5678","amount":"0.01"},
            //      dataType: 'json',
            //      context: $('body'),
            //      success: function(data){

            // todo success
            //          WIN.location.href = 'result.html';

            //      },
            //      error: function(){
            // todo error
            //          WIN.location.href = 'result.html';
            //      }
            //  })

        });


    });
</script>

</body>
</html>