<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>厦门航空</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="aplus-touch" content="1"/>
    <link rel="stylesheet" href="../../stylesheets/refund.css"/>
    <script>(function(a){var d=document.documentElement,c=null;function b(){a.rem=d.getBoundingClientRect().width/20;if(/ZTE U930_TD/.test(navigator.userAgent)){a.rem=a.rem*1.13}d.style.fontSize=a.rem+"px"}b();a.addEventListener("resize",function(){clearTimeout(c);c=setTimeout(b,300)});a.addEventListener("orientationchange",function(){clearTimeout(c);c=setTimeout(b,300)})})(window,undefined);
    </script>
    <script src="../../common/zepto.min.js"></script>
</head>
<body>
<div class="nav-bar">
    <span class="back J_HistoryBack">返回</span>
    选择退票人
</div>

<div class="J_ChoosePeo">

    <div class="container choose-people" id="J_ow" style="display: none">

        <div class="choose-people-list flex total">
            <div class="flex-item3">全选</div>
            <div class="flex-item checkbox-btn" id="J_checkAll"><i class="checkbox-icon"></i></div>
        </div>

        <div class="J_OWChoose"></div>

    </div>



    <div class="container choose-people" id="J_rt" style="display: none">
        <div class="choose-people-list flex total">
            <div class="flex-item2">全选</div>
            <div class="flex-item checkbox-btn" id="J_checkAll1"><i class="checkbox-icon"></i></div>
            <div class="flex-item checkbox-btn" id="J_checkAll2"><i class="checkbox-icon"></i></div>
        </div>

        <div class="J_RTChoose"></div>

    </div>

    <div class="text-center mt40 mb40">
        <a class="btn" href="javascript:;" id="J_NextBtn">下一步</a>
    </div>
</div>


<script type="text/juicer" id="J_ListTpl">

    {@each listInfo as item}

        <div class="choose-people-list flex J_ChooseNum" data-psgrId="${item.psgrId">
            <div class="flex-item3"><p class="people-name">${item.psgrName} ${item.firstName}/${item.lastName}</p><p class="people-card">票号 ${item.certNo}</p></div>
            <div class="flex-item lh40 checkbox-btn J_check" ><i class="checkbox-icon"></i></div>
        </div>

    {@/each}

</script>

<script  type="text/juicer" id="J_ListTpl2">

     {@each listInfo as item}

        <div class="choose-people-list flex J_ChooseNum"  data-psgrId="${item.psgrId}">
            <div class="flex-item2"><p class="people-name">${item.psgrName} ${item.firstName}/${item.lastName}</p><p class="people-card">票号 ${item.certNo}</p></div>
            <div class="flex-item checkbox-btn J_go"><p class="people-flight-type">去程</p><i class="checkbox-icon"></i></div>
            <div class="flex-item checkbox-btn J_back"><p class="people-flight-type">返程</p><i class="checkbox-icon"></i></div>
        </div>

     {@/each}

</script>


<script src="../../common/sea.js"></script>
<script src="../../common/sea-config.js"></script>

<script>
    seajs.use(['tab', 'loading', 'toast', 'juicer', 'util', 'sm', 'common'], function(Tab, Loading, Toast, Juicer, Util, SM, Common) {

        var WIN = window;
        var DOC = document;

        // new Tab('.J_A', '.J_B');

        // var loading = new Loading();
        // loading.show()
        // setTimeout(function(){
        //     loading.hide();
        // }, 2000)

        // Toast('aaaa');

        var J_rt = $('#J_rt');
        var J_ow = $('#J_ow');

        //单程全选
        $(DOC).delegate('#J_checkAll', 'click', function(){
            $('.J_check').toggleClass('active');
        });

        //去程全选
        $(DOC).delegate('#J_checkAll1', 'click', function(){
            $('.J_go').toggleClass('active');
        });

        //返程全选
        $(DOC).delegate('#J_checkAll2', 'click', function(){
            $('.J_back').toggleClass('active');
        });

        //选中
        $(DOC).delegate('.checkbox-btn', 'click', function(){
            var self = $(this);
            self.toggleClass('active');
        });


        var objClone = JSON.parse(Util.locStorage.get('airOrderInfo'));
        console.log(JSON.parse(Util.locStorage.get('airOrderInfo')));

        //判断是单程还是往返
        if(objClone.rangeType == 'RT'){
            J_rt.show();
        }else if(objClone.rangeType == 'OW'){
            J_ow.show();
        }

        var listInfo = objClone.orderPassengerInfo;

        var tpl = $('#J_ListTpl').html();
        var tpl2 = $('#J_ListTpl2').html();

        var htmlStr = Juicer(tpl, { listInfo: listInfo });
        var htmlStr2 = Juicer(tpl2, { listInfo: listInfo });

        $('.J_OWChoose').append(htmlStr);
        $('.J_RTChoose').append(htmlStr2);


        $('#J_NextBtn').click(function(){
            var arrList= [];

            //获取所选内容的值
            $('.J_ChooseNum .checkbox-btn').each(function(){
                var self = $(this);
                if (self.hasClass('active')){
                    var psgrId = $(this).parent().attr('data-psgrId');
                    console.log(psgrId);
                    arrList.push({
                        psgrId: psgrId
                    })
                    console.log(arrList.length);
                }
            });

            var a = arrList.length;
            if(a == '0') {
                Toast('请选择退票人');
            }else{
                WIN.location.href = 'applyRefund.html?a=' +a;
            }



        });


    });
</script>

</body>
</html>